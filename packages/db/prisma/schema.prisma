generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum OrgDomainStatus {
  PENDING
  VERIFIED
  ERROR
}

enum UserStatus {
  INVITED
  ACTIVE
  DISABLED
}

enum CampaignType {
  EVENT
  ONLINE
  HYBRID
  PEER_TO_PEER
  AUCTION_ONLY
}

enum CampaignStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum CampaignPageType {
  HOME
  TICKETS
  AUCTION_CATALOG
  ITEM_DETAIL
  DONATE
  PADDLE_RAISE
  RAFFLE
  STORE
  PEER_TO_PEER
  VOLUNTEER
  SPONSORS
  FAQ
  PORTAL_LOGIN
  VOTING
  THANK_YOU
}

enum ModuleType {
  DONATIONS
  TICKETING
  AUCTION
  PADDLE_RAISE
  RAFFLE
  VOTING
  STORE
  PEER_TO_PEER
  LIVESTREAM
  VOLUNTEER
}

enum CartStatus {
  ACTIVE
  ABANDONED
  CONVERTED
  EXPIRED
}

enum OrderStatus {
  DRAFT
  PENDING
  PAID
  CANCELED
  REFUNDED
}

enum PaymentStatus {
  REQUIRES_PAYMENT
  SUCCEEDED
  FAILED
  CANCELED
  PARTIALLY_REFUNDED
  REFUNDED
}

enum PaymentProvider {
  STRIPE
  MANUAL
}

enum LineItemType {
  DONATION
  TICKET
  ADD_ON
  AUCTION_WIN
  RAFFLE_TICKET
  STORE_ITEM
  FEE_COVERAGE_DONATION
  SHIPPING
  ADJUSTMENT
}

enum LedgerAccountType {
  OPERATING
  PROCESSOR_CLEARING
  PLATFORM_FEES
  REFUNDS
  PAYOUTS
}

enum LedgerEntryType {
  DEBIT
  CREDIT
}

enum CommunicationChannel {
  EMAIL
  SMS
}

enum CommunicationCategory {
  TRANSACTIONAL
  MARKETING
  OUTBID_ALERTS
}

enum ReceiptType {
  TRANSACTIONAL
  YEAR_END
}

enum CustomFieldScope {
  DONOR
}

enum CustomFieldType {
  TEXT
  NUMBER
  DATE
  SELECT
  MULTI_SELECT
}

enum HouseholdMembershipRole {
  PRIMARY
  MEMBER
}

model Organization {
  id              String    @id @default(cuid())
  legalName       String
  publicName      String
  einTaxId        String?   @map("ein_tax_id")
  timezone        String
  logoUrl         String?   @map("logo_url")
  defaultCurrency String    @default("USD") @map("default_currency")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  deletedAt       DateTime? @map("deleted_at")

  domains                     OrgDomain[]
  brandTheme                  OrgBrandTheme?
  users                       User[]
  roles                       Role[]
  donors                      Donor[]
  campaigns                   Campaign[]
  ledgerAccounts              LedgerAccount[]
  ledgerTransactions          LedgerTransaction[]
  ledgerEntries               LedgerEntry[]
  carts                       Cart[]
  orders                      Order[]
  payments                    Payment[]
  refunds                     Refund[]
  payouts                     Payout[]
  receipts                    Receipt[]
  sponsors                    Sponsor[]
  auditLogEntries             AuditLogEntry[]
  communicationPreferences    CommunicationPreference[]
  customFields                CustomField[]
  donorTags                   DonorTag[]
  households                  Household[]
  peerFundraisers             PeerFundraiser[]
  peerFundraisingTeams        PeerFundraisingTeam[]
  peerFundraisingClassrooms   PeerFundraisingClassroom[]
  peerFundraisingAttributions PeerFundraisingAttribution[]
  volunteerShifts             VolunteerShift[]
  volunteerSignups            VolunteerSignup[]
  donorEmails                 DonorEmail[]
  donorPhones                 DonorPhone[]
  donorAddresses              DonorAddress[]
  campaignPages               CampaignPage[]
  pageBlocks                  PageBlock[]
  campaignModules             CampaignModule[]
  sponsorPlacements           SponsorPlacement[]
  cartItems                   CartItem[]
  orderLineItems              OrderLineItem[]
  ticketTypes                 TicketType[]
  ticketAddOns                TicketAddOn[]
  promoCodes                  PromoCode[]
  ticketOrders                TicketOrder[]
  attendees                   Attendee[]
  attendeeAnswers             AttendeeAnswer[]
  tables                      Table[]
  seats                       Seat[]
  checkins                    Checkin[]
  auctions                    Auction[]
  auctionCategories           AuctionCategory[]
  auctionItems                AuctionItem[]
  auctionItemMedia            AuctionItemMedia[]
  procurementDonors           ProcurementDonor[]
  procurementSubmissions      ProcurementSubmission[]
  bids                        Bid[]
  watchlists                  Watchlist[]
  invoices                    Invoice[]
  invoiceItems                InvoiceItem[]
  fulfillmentRecords          FulfillmentRecord[]
  paddleRaiseLevels           PaddleRaiseLevel[]
  paddleRaisePledges          PaddleRaisePledge[]
  liveDisplayScenes           LiveDisplayScene[]
  raffles                     Raffle[]
  raffleTickets               RaffleTicket[]
  raffleDraws                 RaffleDraw[]
  votingContests              VotingContest[]
  voteCandidates              VoteCandidate[]
  votes                       Vote[]
  storeProducts               StoreProduct[]
  storeVariants               StoreVariant[]
  storeOrders                 StoreOrder[]
  emailTemplates              EmailTemplate[]
  smsTemplates                SmsTemplate[]
  messageSends                MessageSend[]
  messageEvents               MessageEvent[]
  keywordRoutes               KeywordRoute[]
  apiTokens                   ApiToken[]
  webhookEndpoints            WebhookEndpoint[]
  webhookDeliveries           WebhookDelivery[]
  crmMappings                 CrmMapping[]
  integrationSyncJobs         IntegrationSyncJob[]

  @@map("organizations")
}

model OrgDomain {
  id         String          @id @default(cuid())
  orgId      String          @map("org_id")
  domain     String
  isPrimary  Boolean         @default(false) @map("is_primary")
  isCustom   Boolean         @default(false) @map("is_custom")
  status     OrgDomainStatus @default(PENDING)
  verifiedAt DateTime?       @map("verified_at")
  createdAt  DateTime        @default(now()) @map("created_at")
  updatedAt  DateTime        @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])

  @@unique([orgId, domain])
  @@index([domain])
  @@map("org_domains")
}

model OrgBrandTheme {
  id        String   @id @default(cuid())
  orgId     String   @unique @map("org_id")
  name      String
  tokens    Json
  customCss String?  @map("custom_css")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])

  @@map("org_brand_themes")
}

model User {
  id          String     @id @default(cuid())
  orgId       String     @map("org_id")
  clerkUserId String     @unique @map("clerk_user_id")
  email       String
  displayName String?    @map("display_name")
  status      UserStatus @default(INVITED)
  lastLoginAt DateTime?  @map("last_login_at")
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")

  organization       Organization         @relation(fields: [orgId], references: [id])
  roleAssignments    UserRoleAssignment[]
  auditLogEntries    AuditLogEntry[]      @relation("AuditLogActor")
  checkins           Checkin[]            @relation("CheckinCreator")
  paddleRaisePledges PaddleRaisePledge[]  @relation("PaddleRaisePledgeEnteredBy")

  @@index([orgId, status])
  @@map("users")
}

model Role {
  id          String   @id @default(cuid())
  orgId       String   @map("org_id")
  key         String
  name        String
  description String?
  isSystem    Boolean  @default(false) @map("is_system")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  organization Organization         @relation(fields: [orgId], references: [id])
  assignments  UserRoleAssignment[]

  @@unique([orgId, key])
  @@map("roles")
}

model UserRoleAssignment {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  roleId    String   @map("role_id")
  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id])
  role Role @relation(fields: [roleId], references: [id])

  @@unique([userId, roleId])
  @@map("user_role_assignments")
}

model AuditLogEntry {
  id          String   @id @default(cuid())
  orgId       String   @map("org_id")
  actorUserId String?  @map("actor_user_id")
  action      String
  targetType  String   @map("target_type")
  targetId    String   @map("target_id")
  beforeData  Json?    @map("before_data")
  afterData   Json?    @map("after_data")
  ipAddress   String?  @map("ip_address")
  userAgent   String?  @map("user_agent")
  createdAt   DateTime @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])
  actor        User?        @relation("AuditLogActor", fields: [actorUserId], references: [id])

  @@index([orgId, createdAt])
  @@map("audit_log_entries")
}

model Donor {
  id            String    @id @default(cuid())
  orgId         String    @map("org_id")
  clerkUserId   String?   @map("clerk_user_id")
  displayName   String?   @map("display_name")
  firstName     String?   @map("first_name")
  lastName      String?   @map("last_name")
  preferredName String?   @map("preferred_name")
  primaryEmail  String?   @map("primary_email")
  primaryPhone  String?   @map("primary_phone")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  deletedAt     DateTime? @map("deleted_at")

  organization             Organization              @relation(fields: [orgId], references: [id])
  emails                   DonorEmail[]
  phones                   DonorPhone[]
  addresses                DonorAddress[]
  tagAssignments           DonorTagAssignment[]
  customFieldValues        DonorCustomFieldValue[]
  householdMemberships     HouseholdMembership[]
  communicationPreferences CommunicationPreference[]
  carts                    Cart[]
  orders                   Order[]
  receipts                 Receipt[]
  attendees                Attendee[]
  bids                     Bid[]
  watchlists               Watchlist[]
  invoices                 Invoice[]
  paddleRaisePledges       PaddleRaisePledge[]
  raffleTickets            RaffleTicket[]
  raffleDraws              RaffleDraw[]
  votes                    Vote[]
  peerFundraisers          PeerFundraiser[]
  volunteerSignups         VolunteerSignup[]

  @@index([orgId, primaryEmail])
  @@index([orgId, primaryPhone])
  @@map("donors")
}

model DonorEmail {
  id         String   @id @default(cuid())
  orgId      String   @map("org_id")
  donorId    String   @map("donor_id")
  email      String
  isPrimary  Boolean  @default(false) @map("is_primary")
  isVerified Boolean  @default(false) @map("is_verified")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  donor        Donor        @relation(fields: [donorId], references: [id])
  organization Organization @relation(fields: [orgId], references: [id])

  @@unique([orgId, email])
  @@index([donorId])
  @@map("donor_emails")
}

model DonorPhone {
  id         String   @id @default(cuid())
  orgId      String   @map("org_id")
  donorId    String   @map("donor_id")
  phoneE164  String   @map("phone_e164")
  isPrimary  Boolean  @default(false) @map("is_primary")
  isVerified Boolean  @default(false) @map("is_verified")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  donor        Donor        @relation(fields: [donorId], references: [id])
  organization Organization @relation(fields: [orgId], references: [id])

  @@unique([orgId, phoneE164])
  @@index([donorId])
  @@map("donor_phones")
}

model DonorAddress {
  id         String   @id @default(cuid())
  orgId      String   @map("org_id")
  donorId    String   @map("donor_id")
  line1      String
  line2      String?
  city       String
  region     String
  postalCode String   @map("postal_code")
  country    String   @default("US")
  isPrimary  Boolean  @default(false) @map("is_primary")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  donor        Donor        @relation(fields: [donorId], references: [id])
  organization Organization @relation(fields: [orgId], references: [id])

  @@index([donorId])
  @@map("donor_addresses")
}

model Household {
  id        String   @id @default(cuid())
  orgId     String   @map("org_id")
  name      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  organization Organization          @relation(fields: [orgId], references: [id])
  memberships  HouseholdMembership[]

  @@index([orgId, name])
  @@map("households")
}

model HouseholdMembership {
  id           String                  @id @default(cuid())
  householdId  String                  @map("household_id")
  donorId      String                  @map("donor_id")
  role         HouseholdMembershipRole @default(MEMBER)
  relationship String?
  createdAt    DateTime                @default(now()) @map("created_at")

  household Household @relation(fields: [householdId], references: [id])
  donor     Donor     @relation(fields: [donorId], references: [id])

  @@unique([householdId, donorId])
  @@map("household_memberships")
}

model DonorTag {
  id        String   @id @default(cuid())
  orgId     String   @map("org_id")
  name      String
  color     String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  organization Organization         @relation(fields: [orgId], references: [id])
  assignments  DonorTagAssignment[]

  @@unique([orgId, name])
  @@map("donor_tags")
}

model DonorTagAssignment {
  id         String   @id @default(cuid())
  donorId    String   @map("donor_id")
  donorTagId String   @map("donor_tag_id")
  createdAt  DateTime @default(now()) @map("created_at")

  donor    Donor    @relation(fields: [donorId], references: [id])
  donorTag DonorTag @relation(fields: [donorTagId], references: [id])

  @@unique([donorId, donorTagId])
  @@map("donor_tag_assignments")
}

model CustomField {
  id        String           @id @default(cuid())
  orgId     String           @map("org_id")
  scope     CustomFieldScope @default(DONOR)
  name      String
  fieldType CustomFieldType  @map("field_type")
  options   Json?
  createdAt DateTime         @default(now()) @map("created_at")
  updatedAt DateTime         @updatedAt @map("updated_at")

  organization Organization            @relation(fields: [orgId], references: [id])
  values       DonorCustomFieldValue[]

  @@unique([orgId, scope, name])
  @@map("custom_fields")
}

model DonorCustomFieldValue {
  id            String   @id @default(cuid())
  donorId       String   @map("donor_id")
  customFieldId String   @map("custom_field_id")
  value         String?
  valueJson     Json?    @map("value_json")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  donor       Donor       @relation(fields: [donorId], references: [id])
  customField CustomField @relation(fields: [customFieldId], references: [id])

  @@unique([donorId, customFieldId])
  @@map("donor_custom_field_values")
}

model CommunicationPreference {
  id        String                @id @default(cuid())
  orgId     String                @map("org_id")
  donorId   String                @map("donor_id")
  channel   CommunicationChannel
  category  CommunicationCategory
  optedIn   Boolean               @default(true) @map("opted_in")
  createdAt DateTime              @default(now()) @map("created_at")
  updatedAt DateTime              @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])
  donor        Donor        @relation(fields: [donorId], references: [id])

  @@unique([donorId, channel, category])
  @@map("communication_preferences")
}

model Campaign {
  id                  String         @id @default(cuid())
  orgId               String         @map("org_id")
  name                String
  slug                String
  description         String?
  type                CampaignType
  status              CampaignStatus @default(DRAFT)
  startsAt            DateTime?      @map("starts_at")
  endsAt              DateTime?      @map("ends_at")
  goalAmount          Int?           @map("goal_amount")
  heroTitle           String?        @map("hero_title")
  heroMediaUrl        String?        @map("hero_media_url")
  storyContent        String?        @map("story_content")
  seoTitle            String?        @map("seo_title")
  seoDescription      String?        @map("seo_description")
  socialShareImageUrl String?        @map("social_share_image_url")
  themeOverrides      Json?          @map("theme_overrides")
  createdAt           DateTime       @default(now()) @map("created_at")
  updatedAt           DateTime       @updatedAt @map("updated_at")

  organization                Organization                 @relation(fields: [orgId], references: [id])
  pages                       CampaignPage[]
  modules                     CampaignModule[]
  sponsorPlacements           SponsorPlacement[]
  carts                       Cart[]
  orders                      Order[]
  peerFundraisers             PeerFundraiser[]
  peerFundraisingTeams        PeerFundraisingTeam[]
  peerFundraisingClassrooms   PeerFundraisingClassroom[]
  peerFundraisingAttributions PeerFundraisingAttribution[]
  volunteerShifts             VolunteerShift[]
  volunteerSignups            VolunteerSignup[]
  ticketTypes                 TicketType[]
  ticketAddOns                TicketAddOn[]
  promoCodes                  PromoCode[]
  ticketOrders                TicketOrder[]
  attendees                   Attendee[]
  tables                      Table[]
  auctions                    Auction[]
  procurementSubmissions      ProcurementSubmission[]
  invoices                    Invoice[]
  paddleRaiseLevels           PaddleRaiseLevel[]
  paddleRaisePledges          PaddleRaisePledge[]
  liveDisplayScenes           LiveDisplayScene[]
  raffles                     Raffle[]
  votingContests              VotingContest[]
  storeProducts               StoreProduct[]
  storeOrders                 StoreOrder[]
  keywordRoutes               KeywordRoute[]

  @@unique([orgId, slug])
  @@index([orgId, status])
  @@map("campaigns")
}

model CampaignPage {
  id          String           @id @default(cuid())
  orgId       String           @map("org_id")
  campaignId  String           @map("campaign_id")
  type        CampaignPageType
  slug        String
  title       String?
  isPublished Boolean          @default(false) @map("is_published")
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])
  campaign     Campaign     @relation(fields: [campaignId], references: [id])
  blocks       PageBlock[]

  @@unique([campaignId, slug])
  @@map("campaign_pages")
}

model PageBlock {
  id             String   @id @default(cuid())
  orgId          String   @map("org_id")
  campaignPageId String   @map("campaign_page_id")
  type           String
  data           Json
  sortOrder      Int      @default(0) @map("sort_order")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])
  page         CampaignPage @relation(fields: [campaignPageId], references: [id])

  @@index([campaignPageId, sortOrder])
  @@map("page_blocks")
}

model CampaignModule {
  id         String     @id @default(cuid())
  orgId      String     @map("org_id")
  campaignId String     @map("campaign_id")
  type       ModuleType
  config     Json?
  isEnabled  Boolean    @default(true) @map("is_enabled")
  createdAt  DateTime   @default(now()) @map("created_at")
  updatedAt  DateTime   @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])
  campaign     Campaign     @relation(fields: [campaignId], references: [id])

  @@unique([campaignId, type])
  @@map("campaign_modules")
}

model Sponsor {
  id         String   @id @default(cuid())
  orgId      String   @map("org_id")
  name       String
  level      String?
  logoUrl    String?  @map("logo_url")
  websiteUrl String?  @map("website_url")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  organization Organization       @relation(fields: [orgId], references: [id])
  placements   SponsorPlacement[]

  @@index([orgId, level])
  @@map("sponsors")
}

model SponsorPlacement {
  id             String   @id @default(cuid())
  orgId          String   @map("org_id")
  sponsorId      String   @map("sponsor_id")
  campaignId     String   @map("campaign_id")
  placementType  String   @map("placement_type")
  placementRefId String   @map("placement_ref_id")
  sortOrder      Int      @default(0) @map("sort_order")
  createdAt      DateTime @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])
  sponsor      Sponsor      @relation(fields: [sponsorId], references: [id])
  campaign     Campaign     @relation(fields: [campaignId], references: [id])

  @@index([campaignId, placementType])
  @@map("sponsor_placements")
}

model Cart {
  id         String     @id @default(cuid())
  orgId      String     @map("org_id")
  campaignId String?    @map("campaign_id")
  donorId    String?    @map("donor_id")
  status     CartStatus @default(ACTIVE)
  expiresAt  DateTime?  @map("expires_at")
  createdAt  DateTime   @default(now()) @map("created_at")
  updatedAt  DateTime   @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])
  campaign     Campaign?    @relation(fields: [campaignId], references: [id])
  donor        Donor?       @relation(fields: [donorId], references: [id])
  items        CartItem[]

  @@index([orgId, status])
  @@map("carts")
}

model CartItem {
  id         String       @id @default(cuid())
  orgId      String       @map("org_id")
  cartId     String       @map("cart_id")
  type       LineItemType
  sourceId   String?      @map("source_id")
  name       String
  quantity   Int          @default(1)
  unitAmount Int          @map("unit_amount")
  currency   String       @default("USD")
  metadata   Json?
  createdAt  DateTime     @default(now()) @map("created_at")
  updatedAt  DateTime     @updatedAt @map("updated_at")

  cart         Cart         @relation(fields: [cartId], references: [id])
  organization Organization @relation(fields: [orgId], references: [id])

  @@index([cartId])
  @@map("cart_items")
}

model Order {
  id                    String      @id @default(cuid())
  orgId                 String      @map("org_id")
  campaignId            String?     @map("campaign_id")
  donorId               String?     @map("donor_id")
  orderNumber           String      @map("order_number")
  status                OrderStatus @default(PENDING)
  totalAmount           Int         @map("total_amount")
  currency              String      @default("USD")
  coverFeesAmount       Int         @default(0) @map("cover_fees_amount")
  stripePaymentIntentId String?     @map("stripe_payment_intent_id")
  createdAt             DateTime    @default(now()) @map("created_at")
  updatedAt             DateTime    @updatedAt @map("updated_at")

  organization  Organization    @relation(fields: [orgId], references: [id])
  campaign      Campaign?       @relation(fields: [campaignId], references: [id])
  donor         Donor?          @relation(fields: [donorId], references: [id])
  lineItems     OrderLineItem[]
  payments      Payment[]
  receipts      Receipt[]
  ticketOrders  TicketOrder[]
  attendees     Attendee[]
  invoices      Invoice[]
  raffleTickets RaffleTicket[]
  storeOrders   StoreOrder[]

  @@unique([orgId, orderNumber])
  @@index([orgId, status])
  @@map("orders")
}

model OrderLineItem {
  id                  String       @id @default(cuid())
  orgId               String       @map("org_id")
  orderId             String       @map("order_id")
  type                LineItemType
  sourceId            String?      @map("source_id")
  description         String?
  quantity            Int          @default(1)
  unitAmount          Int          @map("unit_amount")
  totalAmount         Int          @map("total_amount")
  currency            String       @default("USD")
  fmvAmount           Int          @default(0) @map("fmv_amount")
  benefitAmount       Int          @default(0) @map("benefit_amount")
  taxDeductibleAmount Int          @default(0) @map("tax_deductible_amount")
  metadata            Json?
  createdAt           DateTime     @default(now()) @map("created_at")
  updatedAt           DateTime     @updatedAt @map("updated_at")

  order           Order                       @relation(fields: [orderId], references: [id])
  organization    Organization                @relation(fields: [orgId], references: [id])
  peerAttribution PeerFundraisingAttribution?

  @@index([orderId])
  @@map("order_line_items")
}

model Payment {
  id                String          @id @default(cuid())
  orgId             String          @map("org_id")
  orderId           String?         @map("order_id")
  provider          PaymentProvider
  providerPaymentId String?         @map("provider_payment_id")
  status            PaymentStatus
  amount            Int
  currency          String          @default("USD")
  feeAmount         Int             @default(0) @map("fee_amount")
  netAmount         Int             @default(0) @map("net_amount")
  capturedAt        DateTime?       @map("captured_at")
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @updatedAt @map("updated_at")

  organization       Organization        @relation(fields: [orgId], references: [id])
  order              Order?              @relation(fields: [orderId], references: [id])
  refunds            Refund[]
  ledgerTransactions LedgerTransaction[]

  @@index([orgId, status])
  @@map("payments")
}

model Refund {
  id               String    @id @default(cuid())
  orgId            String    @map("org_id")
  paymentId        String    @map("payment_id")
  providerRefundId String?   @map("provider_refund_id")
  status           String
  amount           Int
  currency         String    @default("USD")
  createdAt        DateTime  @default(now()) @map("created_at")
  processedAt      DateTime? @map("processed_at")

  organization       Organization        @relation(fields: [orgId], references: [id])
  payment            Payment             @relation(fields: [paymentId], references: [id])
  ledgerTransactions LedgerTransaction[]

  @@index([orgId, status])
  @@map("refunds")
}

model Payout {
  id               String    @id @default(cuid())
  orgId            String    @map("org_id")
  providerPayoutId String?   @map("provider_payout_id")
  status           String
  amount           Int
  currency         String    @default("USD")
  arrivalDate      DateTime? @map("arrival_date")
  createdAt        DateTime  @default(now()) @map("created_at")

  organization       Organization        @relation(fields: [orgId], references: [id])
  ledgerTransactions LedgerTransaction[]

  @@index([orgId, arrivalDate])
  @@map("payouts")
}

model LedgerAccount {
  id        String            @id @default(cuid())
  orgId     String            @map("org_id")
  name      String
  type      LedgerAccountType
  currency  String            @default("USD")
  isSystem  Boolean           @default(false) @map("is_system")
  createdAt DateTime          @default(now()) @map("created_at")
  updatedAt DateTime          @updatedAt @map("updated_at")

  organization Organization  @relation(fields: [orgId], references: [id])
  entries      LedgerEntry[]

  @@unique([orgId, name])
  @@map("ledger_accounts")
}

model LedgerTransaction {
  id         String   @id @default(cuid())
  orgId      String   @map("org_id")
  paymentId  String?  @map("payment_id")
  refundId   String?  @map("refund_id")
  payoutId   String?  @map("payout_id")
  type       String
  amount     Int
  currency   String   @default("USD")
  occurredAt DateTime @default(now()) @map("occurred_at")
  createdAt  DateTime @default(now()) @map("created_at")

  organization Organization  @relation(fields: [orgId], references: [id])
  payment      Payment?      @relation(fields: [paymentId], references: [id])
  refund       Refund?       @relation(fields: [refundId], references: [id])
  payout       Payout?       @relation(fields: [payoutId], references: [id])
  entries      LedgerEntry[]

  @@index([orgId, occurredAt])
  @@map("ledger_transactions")
}

model LedgerEntry {
  id                  String          @id @default(cuid())
  orgId               String          @map("org_id")
  ledgerAccountId     String          @map("ledger_account_id")
  ledgerTransactionId String          @map("ledger_transaction_id")
  entryType           LedgerEntryType @map("entry_type")
  amount              Int
  currency            String          @default("USD")
  occurredAt          DateTime        @map("occurred_at")
  referenceType       String?         @map("reference_type")
  referenceId         String?         @map("reference_id")
  memo                String?
  createdAt           DateTime        @default(now()) @map("created_at")

  organization      Organization      @relation(fields: [orgId], references: [id])
  ledgerAccount     LedgerAccount     @relation(fields: [ledgerAccountId], references: [id])
  ledgerTransaction LedgerTransaction @relation(fields: [ledgerTransactionId], references: [id])

  @@index([ledgerAccountId, occurredAt])
  @@map("ledger_entries")
}

model Receipt {
  id            String      @id @default(cuid())
  orgId         String      @map("org_id")
  donorId       String?     @map("donor_id")
  orderId       String?     @map("order_id")
  receiptType   ReceiptType @map("receipt_type")
  receiptNumber String      @map("receipt_number")
  issuedAt      DateTime    @map("issued_at")
  year          Int?
  documentUrl   String?     @map("document_url")
  metadata      Json?
  createdAt     DateTime    @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])
  donor        Donor?       @relation(fields: [donorId], references: [id])
  order        Order?       @relation(fields: [orderId], references: [id])

  @@unique([orgId, receiptNumber])
  @@index([donorId])
  @@map("receipts")
}

enum TicketVisibility {
  PUBLIC
  PRIVATE
}

enum TicketAddOnScope {
  ORDER
  ATTENDEE
}

enum PromoCodeType {
  AMOUNT
  PERCENT
}

enum AttendeeStatus {
  REGISTERED
  CANCELED
}

enum CheckinMethod {
  QR
  SEARCH
  MANUAL
}

enum AuctionStatus {
  DRAFT
  LIVE
  CLOSED
}

enum AuctionItemStatus {
  DRAFT
  PUBLISHED
  CLOSED
}

enum AuctionMediaType {
  IMAGE
  VIDEO
}

enum ProcurementStatus {
  PLEDGED
  RECEIVED
  CATALOGED
  PUBLISHED
  FULFILLED
}

enum BidStatus {
  ACTIVE
  OUTBID
  WINNING
}

enum InvoiceStatus {
  OPEN
  PAID
  VOID
}

enum FulfillmentStatus {
  PENDING
  PICKED_UP
  SHIPPED
  DELIVERED
}

enum PaddleRaiseStatus {
  PLEDGED
  PAID
  CANCELED
}

enum LiveSceneType {
  LEADERBOARD
  THERMOMETER
  ACTIVITY
  SPONSOR
  CTA
}

enum RaffleStatus {
  DRAFT
  ACTIVE
  CLOSED
}

enum PeerFundraiserStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum VolunteerSignupStatus {
  CONFIRMED
  CANCELED
}

enum VotingContestStatus {
  DRAFT
  ACTIVE
  CLOSED
}

enum StoreProductStatus {
  ACTIVE
  INACTIVE
}

enum TemplateStatus {
  DRAFT
  APPROVED
  ARCHIVED
}

enum MessageSendStatus {
  QUEUED
  SENT
  DELIVERED
  FAILED
}

enum MessageEventType {
  DELIVERED
  OPENED
  CLICKED
  FAILED
}

enum KeywordRouteStatus {
  ACTIVE
  INACTIVE
}

enum WebhookStatus {
  ACTIVE
  DISABLED
}

enum WebhookDeliveryStatus {
  PENDING
  SUCCESS
  FAILED
}

enum IntegrationProvider {
  GENERIC
  SALESFORCE
  BLOOMERANG
  DONORPERFECT
  NEONCRM
  RAISERS_EDGE
}

enum SyncJobStatus {
  PENDING
  RUNNING
  SUCCEEDED
  FAILED
}

model TicketType {
  id            String           @id @default(cuid())
  orgId         String           @map("org_id")
  campaignId    String           @map("campaign_id")
  name          String
  description   String?
  price         Int
  currency      String           @default("USD")
  capacity      Int?
  saleStartAt   DateTime?        @map("sale_start_at")
  saleEndAt     DateTime?        @map("sale_end_at")
  minPerOrder   Int?             @map("min_per_order")
  maxPerOrder   Int?             @map("max_per_order")
  visibility    TicketVisibility @default(PUBLIC)
  isComp        Boolean          @default(false) @map("is_comp")
  fmvAmount     Int              @default(0) @map("fmv_amount")
  benefitAmount Int              @default(0) @map("benefit_amount")
  createdAt     DateTime         @default(now()) @map("created_at")
  updatedAt     DateTime         @updatedAt @map("updated_at")

  organization Organization  @relation(fields: [orgId], references: [id])
  campaign     Campaign      @relation(fields: [campaignId], references: [id])
  ticketOrders TicketOrder[]
  attendees    Attendee[]

  @@index([campaignId])
  @@map("ticket_types")
}

model TicketAddOn {
  id          String           @id @default(cuid())
  orgId       String           @map("org_id")
  campaignId  String           @map("campaign_id")
  name        String
  description String?
  price       Int
  scope       TicketAddOnScope @default(ORDER)
  capacity    Int?
  isActive    Boolean          @default(true) @map("is_active")
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])
  campaign     Campaign     @relation(fields: [campaignId], references: [id])

  @@index([campaignId])
  @@map("ticket_add_ons")
}

model PromoCode {
  id             String        @id @default(cuid())
  orgId          String        @map("org_id")
  campaignId     String        @map("campaign_id")
  code           String
  discountType   PromoCodeType @map("discount_type")
  amount         Int
  maxRedemptions Int?          @map("max_redemptions")
  redeemedCount  Int           @default(0) @map("redeemed_count")
  startsAt       DateTime?     @map("starts_at")
  endsAt         DateTime?     @map("ends_at")
  isActive       Boolean       @default(true) @map("is_active")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])
  campaign     Campaign     @relation(fields: [campaignId], references: [id])

  @@unique([campaignId, code])
  @@map("promo_codes")
}

model TicketOrder {
  id           String   @id @default(cuid())
  orgId        String   @map("org_id")
  campaignId   String   @map("campaign_id")
  orderId      String   @map("order_id")
  ticketTypeId String   @map("ticket_type_id")
  quantity     Int      @default(1)
  unitAmount   Int      @map("unit_amount")
  totalAmount  Int      @map("total_amount")
  createdAt    DateTime @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])
  campaign     Campaign     @relation(fields: [campaignId], references: [id])
  order        Order        @relation(fields: [orderId], references: [id])
  ticketType   TicketType   @relation(fields: [ticketTypeId], references: [id])
  attendees    Attendee[]

  @@index([orderId])
  @@map("ticket_orders")
}

model Attendee {
  id            String         @id @default(cuid())
  orgId         String         @map("org_id")
  campaignId    String         @map("campaign_id")
  orderId       String?        @map("order_id")
  ticketOrderId String?        @map("ticket_order_id")
  ticketTypeId  String?        @map("ticket_type_id")
  donorId       String?        @map("donor_id")
  firstName     String?        @map("first_name")
  lastName      String?        @map("last_name")
  email         String?
  phone         String?
  status        AttendeeStatus @default(REGISTERED)
  qrCode        String?        @map("qr_code")
  tableId       String?        @map("table_id")
  seatId        String?        @unique @map("seat_id")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")

  organization Organization     @relation(fields: [orgId], references: [id])
  campaign     Campaign         @relation(fields: [campaignId], references: [id])
  order        Order?           @relation(fields: [orderId], references: [id])
  ticketOrder  TicketOrder?     @relation(fields: [ticketOrderId], references: [id])
  ticketType   TicketType?      @relation(fields: [ticketTypeId], references: [id])
  donor        Donor?           @relation(fields: [donorId], references: [id])
  table        Table?           @relation(fields: [tableId], references: [id])
  seat         Seat?            @relation(fields: [seatId], references: [id])
  answers      AttendeeAnswer[]
  checkins     Checkin[]

  @@index([campaignId])
  @@index([ticketTypeId])
  @@map("attendees")
}

model AttendeeAnswer {
  id         String   @id @default(cuid())
  orgId      String   @map("org_id")
  attendeeId String   @map("attendee_id")
  question   String
  answer     String?
  valueJson  Json?    @map("value_json")
  sortOrder  Int      @default(0) @map("sort_order")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])
  attendee     Attendee     @relation(fields: [attendeeId], references: [id])

  @@index([attendeeId])
  @@map("attendee_answers")
}

model Table {
  id         String   @id @default(cuid())
  orgId      String   @map("org_id")
  campaignId String   @map("campaign_id")
  name       String
  capacity   Int
  sortOrder  Int      @default(0) @map("sort_order")
  notes      String?
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])
  campaign     Campaign     @relation(fields: [campaignId], references: [id])
  seats        Seat[]
  attendees    Attendee[]

  @@index([campaignId])
  @@map("tables")
}

model Seat {
  id         String   @id @default(cuid())
  orgId      String   @map("org_id")
  tableId    String   @map("table_id")
  seatNumber Int      @map("seat_number")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])
  table        Table        @relation(fields: [tableId], references: [id])
  attendee     Attendee?

  @@unique([tableId, seatNumber])
  @@map("seats")
}

model Checkin {
  id              String        @id @default(cuid())
  orgId           String        @map("org_id")
  attendeeId      String        @map("attendee_id")
  method          CheckinMethod
  checkedInAt     DateTime      @map("checked_in_at")
  createdByUserId String?       @map("created_by_user_id")
  createdAt       DateTime      @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])
  attendee     Attendee     @relation(fields: [attendeeId], references: [id])
  createdBy    User?        @relation("CheckinCreator", fields: [createdByUserId], references: [id])

  @@index([attendeeId])
  @@map("checkins")
}

model Auction {
  id                 String        @id @default(cuid())
  orgId              String        @map("org_id")
  campaignId         String        @map("campaign_id")
  name               String
  timezone           String
  opensAt            DateTime?     @map("opens_at")
  closesAt           DateTime?     @map("closes_at")
  status             AuctionStatus @default(DRAFT)
  bidIncrementRules  Json?         @map("bid_increment_rules")
  allowMaxBid        Boolean       @default(true) @map("allow_max_bid")
  allowBuyNow        Boolean       @default(false) @map("allow_buy_now")
  antiSnipingMinutes Int?          @map("anti_sniping_minutes")
  createdAt          DateTime      @default(now()) @map("created_at")
  updatedAt          DateTime      @updatedAt @map("updated_at")

  organization Organization      @relation(fields: [orgId], references: [id])
  campaign     Campaign          @relation(fields: [campaignId], references: [id])
  categories   AuctionCategory[]
  items        AuctionItem[]

  @@index([campaignId])
  @@map("auctions")
}

model AuctionCategory {
  id          String   @id @default(cuid())
  orgId       String   @map("org_id")
  auctionId   String   @map("auction_id")
  name        String
  description String?
  parentId    String?  @map("parent_id")
  sortOrder   Int      @default(0) @map("sort_order")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  organization Organization      @relation(fields: [orgId], references: [id])
  auction      Auction           @relation(fields: [auctionId], references: [id])
  parent       AuctionCategory?  @relation("AuctionCategoryHierarchy", fields: [parentId], references: [id])
  children     AuctionCategory[] @relation("AuctionCategoryHierarchy")
  items        AuctionItem[]

  @@index([auctionId])
  @@map("auction_categories")
}

model AuctionItem {
  id                      String            @id @default(cuid())
  orgId                   String            @map("org_id")
  auctionId               String            @map("auction_id")
  categoryId              String?           @map("category_id")
  title                   String
  description             String?
  fmvAmount               Int               @default(0) @map("fmv_amount")
  startingBid             Int               @default(0) @map("starting_bid")
  bidIncrementOverride    Json?             @map("bid_increment_override")
  buyNowPrice             Int?              @map("buy_now_price")
  quantity                Int               @default(1)
  status                  AuctionItemStatus @default(DRAFT)
  isFeatured              Boolean           @default(false) @map("is_featured")
  isPreviewOnly           Boolean           @default(false) @map("is_preview_only")
  opensAt                 DateTime?         @map("opens_at")
  closesAt                DateTime?         @map("closes_at")
  fulfillmentMethod       String?           @map("fulfillment_method")
  shippingAmount          Int?              @map("shipping_amount")
  procurementSubmissionId String?           @map("procurement_submission_id")
  createdAt               DateTime          @default(now()) @map("created_at")
  updatedAt               DateTime          @updatedAt @map("updated_at")

  organization          Organization           @relation(fields: [orgId], references: [id])
  auction               Auction                @relation(fields: [auctionId], references: [id])
  category              AuctionCategory?       @relation(fields: [categoryId], references: [id])
  procurementSubmission ProcurementSubmission? @relation(fields: [procurementSubmissionId], references: [id])
  media                 AuctionItemMedia[]
  bids                  Bid[]
  watchlist             Watchlist[]
  fulfillmentRecords    FulfillmentRecord[]
  invoiceItems          InvoiceItem[]

  @@index([auctionId])
  @@map("auction_items")
}

model AuctionItemMedia {
  id            String           @id @default(cuid())
  orgId         String           @map("org_id")
  auctionItemId String           @map("auction_item_id")
  type          AuctionMediaType
  url           String
  sortOrder     Int              @default(0) @map("sort_order")
  createdAt     DateTime         @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])
  auctionItem  AuctionItem  @relation(fields: [auctionItemId], references: [id])

  @@index([auctionItemId])
  @@map("auction_item_media")
}

model ProcurementDonor {
  id        String   @id @default(cuid())
  orgId     String   @map("org_id")
  name      String
  email     String?
  phone     String?
  notes     String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  organization Organization            @relation(fields: [orgId], references: [id])
  submissions  ProcurementSubmission[]

  @@index([orgId, name])
  @@map("procurement_donors")
}

model ProcurementSubmission {
  id                 String            @id @default(cuid())
  orgId              String            @map("org_id")
  campaignId         String?           @map("campaign_id")
  procurementDonorId String?           @map("procurement_donor_id")
  status             ProcurementStatus @default(PLEDGED)
  itemTitle          String?           @map("item_title")
  itemDescription    String?           @map("item_description")
  fmvAmount          Int?              @map("fmv_amount")
  restrictions       String?           @map("restrictions")
  notes              String?
  receivedAt         DateTime?         @map("received_at")
  createdAt          DateTime          @default(now()) @map("created_at")
  updatedAt          DateTime          @updatedAt @map("updated_at")

  organization     Organization      @relation(fields: [orgId], references: [id])
  campaign         Campaign?         @relation(fields: [campaignId], references: [id])
  procurementDonor ProcurementDonor? @relation(fields: [procurementDonorId], references: [id])
  auctionItems     AuctionItem[]

  @@map("procurement_submissions")
}

model Bid {
  id            String    @id @default(cuid())
  orgId         String    @map("org_id")
  auctionItemId String    @map("auction_item_id")
  donorId       String    @map("donor_id")
  amount        Int
  maxBidAmount  Int?      @map("max_bid_amount")
  isAuto        Boolean   @default(false) @map("is_auto")
  status        BidStatus @default(ACTIVE)
  createdAt     DateTime  @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])
  auctionItem  AuctionItem  @relation(fields: [auctionItemId], references: [id])
  donor        Donor        @relation(fields: [donorId], references: [id])

  @@index([auctionItemId])
  @@index([donorId])
  @@map("bids")
}

model Watchlist {
  id            String   @id @default(cuid())
  orgId         String   @map("org_id")
  auctionItemId String   @map("auction_item_id")
  donorId       String   @map("donor_id")
  createdAt     DateTime @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])
  auctionItem  AuctionItem  @relation(fields: [auctionItemId], references: [id])
  donor        Donor        @relation(fields: [donorId], references: [id])

  @@unique([auctionItemId, donorId])
  @@map("watchlists")
}

model Invoice {
  id          String        @id @default(cuid())
  orgId       String        @map("org_id")
  campaignId  String?       @map("campaign_id")
  donorId     String?       @map("donor_id")
  orderId     String?       @map("order_id")
  status      InvoiceStatus @default(OPEN)
  totalAmount Int           @map("total_amount")
  currency    String        @default("USD")
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")

  organization Organization  @relation(fields: [orgId], references: [id])
  campaign     Campaign?     @relation(fields: [campaignId], references: [id])
  donor        Donor?        @relation(fields: [donorId], references: [id])
  order        Order?        @relation(fields: [orderId], references: [id])
  items        InvoiceItem[]

  @@index([campaignId])
  @@map("invoices")
}

model InvoiceItem {
  id            String       @id @default(cuid())
  orgId         String       @map("org_id")
  invoiceId     String       @map("invoice_id")
  type          LineItemType
  description   String?
  quantity      Int          @default(1)
  unitAmount    Int          @map("unit_amount")
  totalAmount   Int          @map("total_amount")
  auctionItemId String?      @map("auction_item_id")
  createdAt     DateTime     @default(now()) @map("created_at")

  organization       Organization        @relation(fields: [orgId], references: [id])
  invoice            Invoice             @relation(fields: [invoiceId], references: [id])
  auctionItem        AuctionItem?        @relation(fields: [auctionItemId], references: [id])
  fulfillmentRecords FulfillmentRecord[]

  @@index([invoiceId])
  @@map("invoice_items")
}

model FulfillmentRecord {
  id             String            @id @default(cuid())
  orgId          String            @map("org_id")
  auctionItemId  String?           @map("auction_item_id")
  invoiceItemId  String?           @map("invoice_item_id")
  status         FulfillmentStatus @default(PENDING)
  method         String?
  trackingNumber String?           @map("tracking_number")
  fulfilledAt    DateTime?         @map("fulfilled_at")
  createdAt      DateTime          @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])
  auctionItem  AuctionItem? @relation(fields: [auctionItemId], references: [id])
  invoiceItem  InvoiceItem? @relation(fields: [invoiceItemId], references: [id])

  @@index([auctionItemId])
  @@map("fulfillment_records")
}

model PaddleRaiseLevel {
  id               String   @id @default(cuid())
  orgId            String   @map("org_id")
  campaignId       String   @map("campaign_id")
  amount           Int
  label            String
  matchSponsorName String?  @map("match_sponsor_name")
  sortOrder        Int      @default(0) @map("sort_order")
  isActive         Boolean  @default(true) @map("is_active")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  organization Organization        @relation(fields: [orgId], references: [id])
  campaign     Campaign            @relation(fields: [campaignId], references: [id])
  pledges      PaddleRaisePledge[]

  @@index([campaignId])
  @@map("paddle_raise_levels")
}

model PaddleRaisePledge {
  id              String            @id @default(cuid())
  orgId           String            @map("org_id")
  campaignId      String            @map("campaign_id")
  donorId         String?           @map("donor_id")
  levelId         String?           @map("level_id")
  amount          Int
  paddleNumber    String?           @map("paddle_number")
  status          PaddleRaiseStatus @default(PLEDGED)
  enteredByUserId String?           @map("entered_by_user_id")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")

  organization Organization      @relation(fields: [orgId], references: [id])
  campaign     Campaign          @relation(fields: [campaignId], references: [id])
  donor        Donor?            @relation(fields: [donorId], references: [id])
  level        PaddleRaiseLevel? @relation(fields: [levelId], references: [id])
  enteredBy    User?             @relation("PaddleRaisePledgeEnteredBy", fields: [enteredByUserId], references: [id])

  @@index([campaignId])
  @@map("paddle_raise_pledges")
}

model LiveDisplayScene {
  id         String        @id @default(cuid())
  orgId      String        @map("org_id")
  campaignId String        @map("campaign_id")
  name       String
  sceneType  LiveSceneType @map("scene_type")
  config     Json?
  sortOrder  Int           @default(0) @map("sort_order")
  isActive   Boolean       @default(false) @map("is_active")
  createdAt  DateTime      @default(now()) @map("created_at")
  updatedAt  DateTime      @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])
  campaign     Campaign     @relation(fields: [campaignId], references: [id])

  @@index([campaignId])
  @@map("live_display_scenes")
}

model Raffle {
  id                  String       @id @default(cuid())
  orgId               String       @map("org_id")
  campaignId          String       @map("campaign_id")
  name                String
  status              RaffleStatus @default(DRAFT)
  ticketPrice         Int          @map("ticket_price")
  bundleRules         Json?        @map("bundle_rules")
  maxTicketsPerPerson Int?         @map("max_tickets_per_person")
  startsAt            DateTime?    @map("starts_at")
  endsAt              DateTime?    @map("ends_at")
  rulesUrl            String?      @map("rules_url")
  createdAt           DateTime     @default(now()) @map("created_at")
  updatedAt           DateTime     @updatedAt @map("updated_at")

  organization Organization   @relation(fields: [orgId], references: [id])
  campaign     Campaign       @relation(fields: [campaignId], references: [id])
  tickets      RaffleTicket[]
  draws        RaffleDraw[]

  @@index([campaignId])
  @@map("raffles")
}

model RaffleTicket {
  id        String   @id @default(cuid())
  orgId     String   @map("org_id")
  raffleId  String   @map("raffle_id")
  donorId   String?  @map("donor_id")
  orderId   String?  @map("order_id")
  quantity  Int      @default(1)
  createdAt DateTime @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])
  raffle       Raffle       @relation(fields: [raffleId], references: [id])
  donor        Donor?       @relation(fields: [donorId], references: [id])
  order        Order?       @relation(fields: [orderId], references: [id])

  @@index([raffleId])
  @@map("raffle_tickets")
}

model RaffleDraw {
  id            String   @id @default(cuid())
  orgId         String   @map("org_id")
  raffleId      String   @map("raffle_id")
  drawnAt       DateTime @map("drawn_at")
  winnerDonorId String?  @map("winner_donor_id")
  notes         String?
  createdAt     DateTime @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])
  raffle       Raffle       @relation(fields: [raffleId], references: [id])
  winnerDonor  Donor?       @relation(fields: [winnerDonorId], references: [id])

  @@index([raffleId])
  @@map("raffle_draws")
}

model VotingContest {
  id         String              @id @default(cuid())
  orgId      String              @map("org_id")
  campaignId String              @map("campaign_id")
  name       String
  status     VotingContestStatus @default(DRAFT)
  startsAt   DateTime?           @map("starts_at")
  endsAt     DateTime?           @map("ends_at")
  createdAt  DateTime            @default(now()) @map("created_at")
  updatedAt  DateTime            @updatedAt @map("updated_at")

  organization Organization    @relation(fields: [orgId], references: [id])
  campaign     Campaign        @relation(fields: [campaignId], references: [id])
  candidates   VoteCandidate[]
  votes        Vote[]

  @@index([campaignId])
  @@map("voting_contests")
}

model VoteCandidate {
  id          String   @id @default(cuid())
  orgId       String   @map("org_id")
  contestId   String   @map("contest_id")
  name        String
  description String?
  photoUrl    String?  @map("photo_url")
  sponsorName String?  @map("sponsor_name")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  organization Organization  @relation(fields: [orgId], references: [id])
  contest      VotingContest @relation(fields: [contestId], references: [id])
  votes        Vote[]

  @@index([contestId])
  @@map("vote_candidates")
}

model Vote {
  id          String   @id @default(cuid())
  orgId       String   @map("org_id")
  contestId   String   @map("contest_id")
  candidateId String   @map("candidate_id")
  donorId     String?  @map("donor_id")
  amount      Int      @default(0)
  voteCount   Int      @default(0) @map("vote_count")
  createdAt   DateTime @default(now()) @map("created_at")

  organization Organization  @relation(fields: [orgId], references: [id])
  contest      VotingContest @relation(fields: [contestId], references: [id])
  candidate    VoteCandidate @relation(fields: [candidateId], references: [id])
  donor        Donor?        @relation(fields: [donorId], references: [id])

  @@index([contestId])
  @@map("votes")
}

model PeerFundraisingTeam {
  id         String   @id @default(cuid())
  orgId      String   @map("org_id")
  campaignId String   @map("campaign_id")
  name       String
  slug       String
  story      String?
  goalAmount Int?     @map("goal_amount")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  organization Organization                 @relation(fields: [orgId], references: [id])
  campaign     Campaign                     @relation(fields: [campaignId], references: [id])
  fundraisers  PeerFundraiser[]
  attributions PeerFundraisingAttribution[]

  @@unique([campaignId, slug])
  @@index([campaignId])
  @@map("peer_fundraising_teams")
}

model PeerFundraisingClassroom {
  id          String   @id @default(cuid())
  orgId       String   @map("org_id")
  campaignId  String   @map("campaign_id")
  name        String
  slug        String
  grade       String?
  teacherName String?  @map("teacher_name")
  story       String?
  goalAmount  Int?     @map("goal_amount")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  organization Organization                 @relation(fields: [orgId], references: [id])
  campaign     Campaign                     @relation(fields: [campaignId], references: [id])
  fundraisers  PeerFundraiser[]
  attributions PeerFundraisingAttribution[]

  @@unique([campaignId, slug])
  @@index([campaignId])
  @@map("peer_fundraising_classrooms")
}

model PeerFundraiser {
  id          String               @id @default(cuid())
  orgId       String               @map("org_id")
  campaignId  String               @map("campaign_id")
  donorId     String?              @map("donor_id")
  teamId      String?              @map("team_id")
  classroomId String?              @map("classroom_id")
  name        String
  slug        String
  story       String?
  photoUrl    String?              @map("photo_url")
  goalAmount  Int?                 @map("goal_amount")
  status      PeerFundraiserStatus @default(PUBLISHED)
  createdAt   DateTime             @default(now()) @map("created_at")
  updatedAt   DateTime             @updatedAt @map("updated_at")

  organization Organization                 @relation(fields: [orgId], references: [id])
  campaign     Campaign                     @relation(fields: [campaignId], references: [id])
  donor        Donor?                       @relation(fields: [donorId], references: [id])
  team         PeerFundraisingTeam?         @relation(fields: [teamId], references: [id])
  classroom    PeerFundraisingClassroom?    @relation(fields: [classroomId], references: [id])
  attributions PeerFundraisingAttribution[]

  @@unique([campaignId, slug])
  @@index([campaignId])
  @@map("peer_fundraisers")
}

model PeerFundraisingAttribution {
  id              String   @id @default(cuid())
  orgId           String   @map("org_id")
  campaignId      String   @map("campaign_id")
  orderLineItemId String   @map("order_line_item_id")
  fundraiserId    String?  @map("fundraiser_id")
  teamId          String?  @map("team_id")
  classroomId     String?  @map("classroom_id")
  createdAt       DateTime @default(now()) @map("created_at")

  organization  Organization              @relation(fields: [orgId], references: [id])
  campaign      Campaign                  @relation(fields: [campaignId], references: [id])
  orderLineItem OrderLineItem             @relation(fields: [orderLineItemId], references: [id])
  fundraiser    PeerFundraiser?           @relation(fields: [fundraiserId], references: [id])
  team          PeerFundraisingTeam?      @relation(fields: [teamId], references: [id])
  classroom     PeerFundraisingClassroom? @relation(fields: [classroomId], references: [id])

  @@unique([orderLineItemId])
  @@index([campaignId])
  @@index([fundraiserId])
  @@index([teamId])
  @@index([classroomId])
  @@map("peer_fundraising_attributions")
}

model VolunteerShift {
  id          String    @id @default(cuid())
  orgId       String    @map("org_id")
  campaignId  String    @map("campaign_id")
  name        String
  description String?
  startsAt    DateTime? @map("starts_at")
  endsAt      DateTime? @map("ends_at")
  capacity    Int?
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  organization Organization      @relation(fields: [orgId], references: [id])
  campaign     Campaign          @relation(fields: [campaignId], references: [id])
  signups      VolunteerSignup[]

  @@index([campaignId])
  @@map("volunteer_shifts")
}

model VolunteerSignup {
  id         String                @id @default(cuid())
  orgId      String                @map("org_id")
  campaignId String                @map("campaign_id")
  shiftId    String                @map("shift_id")
  donorId    String?               @map("donor_id")
  name       String
  email      String?
  phone      String?
  status     VolunteerSignupStatus @default(CONFIRMED)
  createdAt  DateTime              @default(now()) @map("created_at")

  organization Organization   @relation(fields: [orgId], references: [id])
  campaign     Campaign       @relation(fields: [campaignId], references: [id])
  shift        VolunteerShift @relation(fields: [shiftId], references: [id])
  donor        Donor?         @relation(fields: [donorId], references: [id])

  @@index([shiftId])
  @@index([campaignId])
  @@map("volunteer_signups")
}

model StoreProduct {
  id               String             @id @default(cuid())
  orgId            String             @map("org_id")
  campaignId       String             @map("campaign_id")
  name             String
  description      String?
  status           StoreProductStatus @default(ACTIVE)
  price            Int
  currency         String             @default("USD")
  sku              String?
  inventoryCount   Int?               @map("inventory_count")
  shippingRequired Boolean            @default(false) @map("shipping_required")
  createdAt        DateTime           @default(now()) @map("created_at")
  updatedAt        DateTime           @updatedAt @map("updated_at")

  organization Organization   @relation(fields: [orgId], references: [id])
  campaign     Campaign       @relation(fields: [campaignId], references: [id])
  variants     StoreVariant[]

  @@index([campaignId])
  @@map("store_products")
}

model StoreVariant {
  id             String   @id @default(cuid())
  orgId          String   @map("org_id")
  productId      String   @map("product_id")
  name           String
  sku            String?
  price          Int?
  inventoryCount Int?     @map("inventory_count")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])
  product      StoreProduct @relation(fields: [productId], references: [id])

  @@index([productId])
  @@map("store_variants")
}

model StoreOrder {
  id         String      @id @default(cuid())
  orgId      String      @map("org_id")
  campaignId String?     @map("campaign_id")
  orderId    String      @map("order_id")
  status     OrderStatus @default(PENDING)
  createdAt  DateTime    @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])
  campaign     Campaign?    @relation(fields: [campaignId], references: [id])
  order        Order        @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@map("store_orders")
}

model EmailTemplate {
  id        String         @id @default(cuid())
  orgId     String         @map("org_id")
  name      String
  subject   String
  html      String
  status    TemplateStatus @default(DRAFT)
  version   Int            @default(1)
  createdAt DateTime       @default(now()) @map("created_at")
  updatedAt DateTime       @updatedAt @map("updated_at")

  organization Organization  @relation(fields: [orgId], references: [id])
  messageSends MessageSend[]

  @@unique([orgId, name, version])
  @@map("email_templates")
}

model SmsTemplate {
  id        String         @id @default(cuid())
  orgId     String         @map("org_id")
  name      String
  body      String
  status    TemplateStatus @default(DRAFT)
  version   Int            @default(1)
  createdAt DateTime       @default(now()) @map("created_at")
  updatedAt DateTime       @updatedAt @map("updated_at")

  organization Organization  @relation(fields: [orgId], references: [id])
  messageSends MessageSend[]

  @@unique([orgId, name, version])
  @@map("sms_templates")
}

model MessageSend {
  id                String               @id @default(cuid())
  orgId             String               @map("org_id")
  channel           CommunicationChannel
  emailTemplateId   String?              @map("email_template_id")
  smsTemplateId     String?              @map("sms_template_id")
  to                String
  subject           String?
  body              String
  status            MessageSendStatus    @default(QUEUED)
  providerMessageId String?              @map("provider_message_id")
  scheduledAt       DateTime?            @map("scheduled_at")
  sentAt            DateTime?            @map("sent_at")
  createdAt         DateTime             @default(now()) @map("created_at")
  updatedAt         DateTime             @updatedAt @map("updated_at")

  organization  Organization   @relation(fields: [orgId], references: [id])
  emailTemplate EmailTemplate? @relation(fields: [emailTemplateId], references: [id])
  smsTemplate   SmsTemplate?   @relation(fields: [smsTemplateId], references: [id])
  events        MessageEvent[]

  @@index([channel, status])
  @@map("message_sends")
}

model MessageEvent {
  id              String           @id @default(cuid())
  orgId           String           @map("org_id")
  messageSendId   String           @map("message_send_id")
  eventType       MessageEventType @map("event_type")
  providerEventId String?          @map("provider_event_id")
  occurredAt      DateTime         @map("occurred_at")
  createdAt       DateTime         @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])
  messageSend  MessageSend  @relation(fields: [messageSendId], references: [id])

  @@index([messageSendId])
  @@map("message_events")
}

model KeywordRoute {
  id           String             @id @default(cuid())
  orgId        String             @map("org_id")
  keyword      String
  campaignId   String?            @map("campaign_id")
  replyMessage String?            @map("reply_message")
  status       KeywordRouteStatus @default(ACTIVE)
  createdAt    DateTime           @default(now()) @map("created_at")
  updatedAt    DateTime           @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])
  campaign     Campaign?    @relation(fields: [campaignId], references: [id])

  @@unique([orgId, keyword])
  @@map("keyword_routes")
}

model ApiToken {
  id         String    @id @default(cuid())
  orgId      String    @map("org_id")
  name       String
  tokenHash  String    @map("token_hash")
  scopes     String[]
  lastUsedAt DateTime? @map("last_used_at")
  createdAt  DateTime  @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])

  @@unique([orgId, name])
  @@map("api_tokens")
}

model WebhookEndpoint {
  id        String        @id @default(cuid())
  orgId     String        @map("org_id")
  url       String
  secret    String
  events    String[]
  status    WebhookStatus @default(ACTIVE)
  createdAt DateTime      @default(now()) @map("created_at")
  updatedAt DateTime      @updatedAt @map("updated_at")

  organization Organization      @relation(fields: [orgId], references: [id])
  deliveries   WebhookDelivery[]

  @@map("webhook_endpoints")
}

model WebhookDelivery {
  id            String                @id @default(cuid())
  orgId         String                @map("org_id")
  endpointId    String                @map("endpoint_id")
  eventType     String                @map("event_type")
  payload       Json
  status        WebhookDeliveryStatus @default(PENDING)
  responseCode  Int?                  @map("response_code")
  attempts      Int                   @default(0)
  nextAttemptAt DateTime?             @map("next_attempt_at")
  createdAt     DateTime              @default(now()) @map("created_at")
  updatedAt     DateTime              @updatedAt @map("updated_at")

  organization Organization    @relation(fields: [orgId], references: [id])
  endpoint     WebhookEndpoint @relation(fields: [endpointId], references: [id])

  @@index([endpointId])
  @@map("webhook_deliveries")
}

model CrmMapping {
  id        String              @id @default(cuid())
  orgId     String              @map("org_id")
  provider  IntegrationProvider
  config    Json
  createdAt DateTime            @default(now()) @map("created_at")
  updatedAt DateTime            @updatedAt @map("updated_at")

  organization Organization @relation(fields: [orgId], references: [id])

  @@map("crm_mappings")
}

model IntegrationSyncJob {
  id         String              @id @default(cuid())
  orgId      String              @map("org_id")
  provider   IntegrationProvider
  status     SyncJobStatus       @default(PENDING)
  details    Json?
  startedAt  DateTime?           @map("started_at")
  finishedAt DateTime?           @map("finished_at")
  createdAt  DateTime            @default(now()) @map("created_at")

  organization Organization @relation(fields: [orgId], references: [id])

  @@map("integration_sync_jobs")
}
